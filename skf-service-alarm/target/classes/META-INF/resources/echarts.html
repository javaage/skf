<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
	<script src="jquery.min.js"></script>
    <script src="echarts.min.js"></script>
	
</head>
<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
	
	<button value="1000趋势图" onclick="trend(1000)">1000趋势图</button>
	<button value="5000趋势图" onclick="trend(5000)">5000趋势图</button>
	<button value="5000趋势图" onclick="spectrum(1)">3200频谱图</button>
	<button value="5000趋势图" onclick="spectrum(2)">6400频谱图</button>
    <div id="main" style="width: 1200px;height:600px;"></div>
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
		var x ,y;
		var myChart = echarts.init(document.getElementById('main'));
		//var url = "http://localhost:8080";
		var url = '';
		function trend(count) {
			$.getJSON(url + "/api/meas/trend/2013-07-15/2019-07-16/6/" + count,function(data,status){	
				if (status == 'success') {
					var option = getOption(dateFormat(data.times), data.values, 'score');
					myChart.setOption(option);
				}
			});
		} 

		function spectrum(count) {
			var date = '2018-01-04 04:09:41';			
			$.getJSON(url + "/api/meas/spectrum/" + Number(new Date(date)) + "/6/" + count,function(data,status){	
				if (status == 'success') {	
					var rawData = data.rawData;
					var option = getOption(getSpectrumXdata(rawData.length, data.endFreq), rawData, 'Hz');
					myChart.setOption(option);
				}
			});
		}
		
		function getSpectrumXdata(count, endFreq) {
			var xData;
			if (count > 0 && endFreq > 0) {
				xData = new Array();
				xData[0] = 0;
				for (var i = 1; i < count; i++) {
					xData[i] = endFreq * i / (count - 1);
				}
			}
			return xData;
		}
		
		function getOption(xData,yData,yt) {
			var y50 = yData[50];
			var option = {
				tooltip : {
					trigger: 'axis'
				},
				toolbox: {
					show : false,
					feature : {
						mark : {show: true},
						dataView : {show: true, readOnly: false},
						magicType : {show: true, type: ['line', 'bar']},
						restore : {show: true},
						saveAsImage : {show: true}
					}
				},
				dataZoom: {
					show: true,
					start : 0
				},
				animation : false,
				calculable : true,
				xAxis : [
					{
						type : 'category',
						boundaryGap : false,
						data : xData
					}
				],
				yAxis : [
					{
						type : 'value',
						axisLabel : {
							formatter: '{value}'
						}
					}
				],
				series : [
					{
						name:yt,
						type:'line',
						data:yData,
						showSymbol: false
					}
				]
			};
			return option;
		}
		
		function dateFormat(times) {
			var stringTimes;
			if (times != null && times.length > 0){
				stringTimes = new Array();
				for (var i = 0; i < times.length; i++) {
					stringTimes[i] = new Date(times[i]).Format("yyyy-MM-dd hh:mm:ss");
				}
			}
			return stringTimes;
		}

        // 使用刚指定的配置项和数据显示图表。
        
		Date.prototype.Format = function (fmt) { // 
			var o = {
				"M+": this.getMonth() + 1, //月份 
				"d+": this.getDate(), //日 
				"h+": this.getHours(), //小时 
				"m+": this.getMinutes(), //分 
				"s+": this.getSeconds(), //秒 
				"q+": Math.floor((this.getMonth() + 3) / 3), //季度 
				"S": this.getMilliseconds() //毫秒 
			};
			if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			for (var k in o)
			if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
			return fmt;
		}
    </script>
</body>
</html>