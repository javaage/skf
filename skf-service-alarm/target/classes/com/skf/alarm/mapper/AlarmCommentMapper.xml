<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skf.alarm.mapper.AlarmCommentMapper">
	
	<resultMap type="com.skf.alarm.model.AlarmCommentModel" id="comment">
		<result column="USR_IMG" jdbcType="LONGVARBINARY" property="avator" />
		<result column="USR_NAME" jdbcType="VARCHAR" property="userName" />
		<result column="TIME" jdbcType="VARCHAR" property="releaseTime" />
		<result column="COMMENT" jdbcType="VARCHAR" property="description" />
		<result column="TYPE" jdbcType="INTEGER" property="type" />
	</resultMap>
	
	<select id="list" resultMap="comment">
		SELECT DATE_FORMAT(c.TIME, '%Y-%m-%d %H:%i:%s') AS TIME,
			c.TYPE,
			c.COMMENT,
			u.USR_NAME,
			u.USR_IMG
		FROM SKF_ALRM_CMMT c
		LEFT JOIN SKF_USR u ON c.USR_CODE = u.USR_CODE
		WHERE c.CMPT_CODE = #{componentCode, jdbcType=VARCHAR}
		AND c.ALRM_TYPE = #{alarmType, jdbcType=INTEGER}
		ORDER BY c.TIME DESC
	</select>
	
	<insert id="save" parameterType="com.skf.alarm.entity.AlarmComment">
		INSERT INTO SKF_ALRM_CMMT (
		CMPT_CODE,
		ALRM_TYPE,
		USR_CODE,
		TYPE,
		COMMENT
		) VALUES (
		#{comment.componentCode, jdbcType=VARCHAR},
		#{comment.alarmType, jdbcType=VARCHAR},
		#{comment.userCode, jdbcType=VARCHAR},
		#{comment.type, jdbcType=INTEGER},
		#{comment.comment, jdbcType=VARCHAR}
		)
	</insert>
	
	<delete id="delete">
		DELETE FROM SKF_ALRM_CMMT
		WHERE CMPT_CODE = #{componentCode, jdbcType=VARCHAR}
		AND ALRM_TYPE = #{alarmType, jdbcType=INTEGER}
	</delete>
	
</mapper>